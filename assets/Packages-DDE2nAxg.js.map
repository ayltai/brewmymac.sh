{"version":3,"file":"Packages-DDE2nAxg.js","sources":["../../src/routes/Packages.tsx"],"sourcesContent":["import type { SearchResult, } from 'minisearch';\nimport React, { useCallback, useEffect, useState, } from 'react';\nimport { useTranslation, } from 'react-i18next';\n\nimport { useCaskQuery, useFormulaQuery, useIngredientsQuery, useSearchQuery, } from '../apis';\nimport { Catalogue, CatalogueItem, } from '../components/Catalogue';\nimport { DetailsView, } from '../components/DetailsView';\nimport { HOMEBREW_REFRESH_INTERVAL, INGREDIENT_CATEGORIES, MIN_SEARCH_LENGTH, RECIPE_COMMANDS, } from '../constants';\nimport { useAppDispatch, useAppSelector, } from '../hooks';\nimport type { Ingredient, } from '../models';\nimport { addIngredient, removeIngredient, } from '../states';\nimport { handleError, } from '../utils';\n\nexport const Packages = () => {\n    const [ query,                 setQuery,                 ] = useState('');\n    const [ downloadedIngredients, setDownloadedIngredients, ] = useState<Ingredient[]>([]);\n\n    const { ingredients, } : { ingredients : Ingredient[], } = useAppSelector(state => state.recipe);\n\n    const { data : suggestedIngredients, error : ingredientsError, } = useIngredientsQuery(undefined, {\n        pollingInterval : HOMEBREW_REFRESH_INTERVAL,\n    });\n\n    const { data : caskData, error : caskError, } = useCaskQuery(undefined, {\n        pollingInterval : HOMEBREW_REFRESH_INTERVAL,\n    });\n\n    const { data : formulaData, error : formulaError, } = useFormulaQuery(undefined, {\n        pollingInterval : HOMEBREW_REFRESH_INTERVAL,\n    });\n\n    const { data : searchData, error : searchError, isFetching, isLoading, } = useSearchQuery(query, {\n        skip : query.length < MIN_SEARCH_LENGTH,\n    });\n\n    const dispatch = useAppDispatch();\n\n    const { t, } = useTranslation();\n\n    const searchResultMapper = useCallback((result : SearchResult) => ({\n        id          : result.id,\n        name        : result.name,\n        description : result.description,\n        imageUrl    : result.imageUrl,\n        infoUrl     : result.infoUrl,\n        author      : result.author,\n        source      : result.source,\n    }), []);\n\n    const handleSearch = (keywords? : string) => setQuery(keywords ?? '');\n\n    const handleSelectionChange = useCallback((ingredient : Ingredient, selected : boolean) => dispatch(selected ? addIngredient(ingredient) : removeIngredient(ingredient)), [ dispatch, ]);\n\n    const renderCatalogueItem = useCallback((ingredient : Ingredient) => (\n        <CatalogueItem\n            key={ingredient.id}\n            selected={ingredients.some(item => item.id === ingredient.id)}\n            item={ingredient}\n            detailsView={\n                <DetailsView\n                    description={ingredient.description}\n                    infoUrl={ingredient.infoUrl} />\n            }\n            onSelectionChange={handleSelectionChange} />\n    ), [ handleSelectionChange, ingredients, ]);\n\n    useEffect(() => {\n        const newDownloadedIngredients : Ingredient[] = [];\n\n        if (caskData) newDownloadedIngredients.push(...caskData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        if (formulaData) newDownloadedIngredients.push(...formulaData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        if (searchData) newDownloadedIngredients.push(...searchData.map(item => ({\n            ...item,\n            id : `${item.source}/${item.id}`,\n        })));\n\n        setDownloadedIngredients(newDownloadedIngredients);\n    }, [ caskData, formulaData, searchData, ]);\n\n    useEffect(() => {\n        if (ingredientsError) handleError(ingredientsError);\n        if (caskError) handleError(caskError);\n        if (formulaError) handleError(formulaError);\n        if (searchError) handleError(searchError);\n    }, [ ingredientsError, caskError, formulaError, searchError, ]);\n\n    return (\n        <Catalogue\n            searching={isFetching || isLoading}\n            suggestedItems={suggestedIngredients}\n            downloadedItems={downloadedIngredients}\n            tagLine={t('packages.tagline')}\n            searchHint={t('packages.search.hint')}\n            title={t('packages.about.title')}\n            description={t('packages.about.description')}\n            commands={RECIPE_COMMANDS}\n            categories={INGREDIENT_CATEGORIES}\n            itemFields={[\n                'id',\n                'name',\n                'description',\n                'imageUrl',\n                'infoUrl',\n                'author',\n                'source',\n            ]}\n            loadingMessage={t('packages.loading')}\n            renderCatalogueItem={renderCatalogueItem}\n            searchResultMapper={searchResultMapper}\n            onSearch={handleSearch} />\n    );\n};\n"],"names":["Packages","query","setQuery","useState","downloadedIngredients","setDownloadedIngredients","ingredients","useAppSelector","state","suggestedIngredients","ingredientsError","useIngredientsQuery","HOMEBREW_REFRESH_INTERVAL","caskData","caskError","useCaskQuery","formulaData","formulaError","useFormulaQuery","searchData","searchError","isFetching","isLoading","useSearchQuery","MIN_SEARCH_LENGTH","dispatch","useAppDispatch","t","useTranslation","searchResultMapper","useCallback","result","handleSearch","keywords","handleSelectionChange","ingredient","selected","addIngredient","removeIngredient","renderCatalogueItem","jsx","CatalogueItem","item","DetailsView","useEffect","newDownloadedIngredients","handleError","Catalogue","RECIPE_COMMANDS","INGREDIENT_CATEGORIES"],"mappings":"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"}