{"version":3,"file":"Tweaks-Bgpz-TyY.js","sources":["../../node_modules/.pnpm/@mui+icons-material@5.15.11_@mui+material@5.15.11_@types+react@18.2.58_react@18.2.0/node_modules/@mui/icons-material/Settings.js","../../src/routes/Tweaks.tsx"],"sourcesContent":["\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6\"\n}), 'Settings');","import Settings from '@mui/icons-material/Settings';\nimport Box from '@mui/material/Box';\nimport Container from '@mui/material/Container';\nimport Stack from '@mui/material/Stack';\nimport Typography from '@mui/material/Typography';\nimport MiniSearch from 'minisearch';\nimport React, { useCallback, useContext, useEffect, useRef, useState, useTransition, } from 'react';\nimport { useTranslation, } from 'react-i18next';\n\nimport { useTweaksQuery, } from '../apis';\nimport { MIN_SEARCH_LENGTH, SEARCH_FUZZINESS, SPELLBOOK_COMMANDS, TWEAKS_REFRESH_INTERVAL, TWEAK_CATEGORIES, } from '../constants';\nimport { SelectableCardView, } from '../components/CardView';\nimport { TweakDetailsView, } from '../components/DetailsView';\nimport { GridView, SectionedGridView, } from '../components/GridView';\nimport { Loading, } from '../components/Loading';\nimport { SearchInput, } from '../components/SearchInput';\nimport { StyledButton, } from '../components/StyledButton';\nimport { Terminal, } from '../components/Terminal';\nimport { FirebaseContext, } from '../contexts';\nimport { useAppDispatch, useAppSelector, } from '../hooks';\nimport type { Tweak, } from '../models';\nimport { addTweak, removeTweak, updateTweak, } from '../states';\nimport { handleError, logAddToCart, logPageView, logRemoveFromCart, logSearch, } from '../utils';\n\nexport const Tweaks = () => {\n    const [ query,         setQuery,         ] = useState('');\n    const [ matchedTweaks, setMatchedTweaks, ] = useState<Tweak[] | undefined>();\n    const [ cachedTweaks,  setCachedTweaks,  ] = useState<Tweak[] | undefined>();\n\n    const { tweaks, } : { tweaks : Tweak[], } = useAppSelector(state => state.spellbook);\n\n    const { data, error, } = useTweaksQuery(undefined, {\n        pollingInterval : TWEAKS_REFRESH_INTERVAL,\n    });\n\n    const searchEngine = useRef<MiniSearch<Omit<Tweak, 'imageUrl' | 'infoUrl'>>>(new MiniSearch({\n        fields        : [\n            'id',\n            'name',\n            'description',\n        ],\n        storeFields   : [\n            'id',\n            'name',\n            'description',\n            'imageUrl',\n            'infoUrl',\n            'author',\n            'parameters',\n            'types',\n            'values',\n            'impact',\n            'privileged',\n            'sipInvolved',\n        ],\n        searchOptions : {\n            fuzzy : SEARCH_FUZZINESS,\n        },\n    }));\n\n    const dispatch = useAppDispatch();\n\n    const app = useContext(FirebaseContext);\n\n    const [ isPending, startTransition, ] = useTransition();\n\n    const { t, } = useTranslation();\n\n    const search = useCallback((keyword : string) => {\n        if (app) logSearch(app, {\n            query : keyword,\n        });\n\n        return searchEngine.current.search(keyword).map(result => ({\n            id          : result.id,\n            name        : result.name,\n            description : result.description,\n            imageUrl    : result.imageUrl,\n            infoUrl     : result.infoUrl,\n            author      : result.author,\n            parameters  : result.parameters,\n            types       : result.types,\n            values      : result.values,\n            impact      : result.impact,\n            privileged  : result.privileged,\n            sipInvolved : result.sipInvolved,\n        }));\n    }, [ app, ]);\n\n    const handleSearch = (keyword? : string) => setQuery(keyword ?? '');\n\n    const TweakView = ({\n        tweak,\n    } : {\n        tweak : Tweak,\n    }) => {\n        const tweakRef = useRef({\n            ...tweak,\n        });\n\n        const isSelected = tweaks.some(selected => selected.id === tweak.id);\n\n        const handleSelectionChange = (selected : boolean) => {\n            if (app) {\n                if (selected) {\n                    logAddToCart(app, {\n                        itemId : tweak.id,\n                    });\n                } else {\n                    logRemoveFromCart(app, {\n                        itemId : tweak.id,\n                    });\n                }\n            }\n\n            dispatch(selected ? addTweak(tweak) : removeTweak(tweak));\n        };\n\n        const handleValueChange = (parameter : string, value? : boolean | number | string) => {\n            if (value) {\n                const targetIndex = tweak.parameters.indexOf(parameter);\n                tweakRef.current.values = tweakRef.current.values.map((oldValue, index) => index === targetIndex ? value : oldValue);\n            }\n        };\n\n        const handleSubmit = () => {\n            const updatedTweak = {\n                ...tweakRef.current,\n            };\n\n            if (cachedTweaks) {\n                const newCachedTweaks = [\n                    ...cachedTweaks,\n                ];\n\n                newCachedTweaks[newCachedTweaks.findIndex(cachedTweak => cachedTweak.id === updatedTweak.id)] = updatedTweak;\n\n                setCachedTweaks(newCachedTweaks);\n            }\n\n            if (matchedTweaks) {\n                const newMatchedTweaks = [\n                    ...matchedTweaks,\n                ];\n\n                newMatchedTweaks[newMatchedTweaks.findIndex(matchedTweak => matchedTweak.id === updatedTweak.id)] = updatedTweak;\n\n                setMatchedTweaks(newMatchedTweaks);\n            }\n\n            if (tweaks.some(selectedTweak => selectedTweak.id === updatedTweak.id)) dispatch(updateTweak(updatedTweak));\n        };\n\n        useEffect(() => {\n            tweakRef.current = {\n                ...tweak,\n            };\n        }, [ tweak, ]);\n\n        return (\n            <SelectableCardView\n                key={tweak.id}\n                selected={isSelected}\n                color='secondary'\n                title={tweak.name}\n                subtitle={tweak.author}\n                description={tweak.description}\n                action={\n                    <StyledButton\n                        color='secondary'\n                        onClick={handleSubmit}>\n                        {t('action.save')}\n                    </StyledButton>\n                }\n                actionText={isSelected ? t('action.configure') : undefined}\n                actionIcon={isSelected ? <Settings /> : undefined}\n                onChange={handleSelectionChange}>\n                <TweakDetailsView\n                    description={tweak.description}\n                    infoUrl={tweak.infoUrl}\n                    parameters={tweak.parameters}\n                    types={tweak.types}\n                    values={tweak.values}\n                    onChange={handleValueChange} />\n            </SelectableCardView>\n        );\n    };\n\n    useEffect(() => {\n        searchEngine.current.removeAll();\n\n        if (data) searchEngine.current.addAll(data);\n\n        if (query.length < MIN_SEARCH_LENGTH) {\n            setMatchedTweaks(undefined);\n        } else {\n            startTransition(() => setMatchedTweaks(search(query)));\n        }\n    }, [ data, query, search, ]);\n\n    useEffect(() => {\n        if (data) setCachedTweaks(data);\n    }, [ data, ]);\n\n    useEffect(() => {\n        if (error) handleError(error);\n    }, [ error, ]);\n\n    useEffect(() => {\n        if (app) logPageView(app, {\n            pageName : 'Tweaks',\n            route    : '/tweaks',\n        });\n    }, [ app, ]);\n\n    return (\n        <>\n            <Stack\n                paddingBottom={16}\n                spacing={2}\n                alignItems='center'>\n                <Box\n                    sx={{\n                        animation            : 'gradient 16s ease infinite',\n                        background           : 'linear-gradient(315deg, #e5aac3 3%, #e8f5c8 38%, #07a3b2 68%, #6cc6cb 98%)',\n                        backgroundSize       : '400%',\n                        backgroundAttachment : 'fixed',\n                        overflow             : 'hidden',\n                    }}\n                    width='100%'\n                    padding={8}\n                    position='relative'\n                    textAlign='center'>\n                    <div className='wave' />\n                    <div className='wave' />\n                    <div className='wave' />\n                    <Container maxWidth='lg'>\n                        <Typography\n                            paddingX={8}\n                            paddingBottom={8}\n                            textAlign='center'\n                            variant='h2'>\n                            {t('tweaks.tagline')}\n                        </Typography>\n                        <SearchInput\n                            loading={isPending}\n                            hint={t('tweaks.search.hint')}\n                            onSearch={handleSearch} />\n                    </Container>\n                </Box>\n                {!matchedTweaks && (\n                    <Container maxWidth='lg'>\n                        <Stack\n                            paddingTop={8}\n                            display='flex'\n                            direction='row'>\n                            <Box flexGrow={1}>\n                                <Typography\n                                    gutterBottom\n                                    paddingTop={2}\n                                    color='secondary'\n                                    variant='h4'>\n                                    {t('tweaks.about.title')}\n                                </Typography>\n                                <Typography variant='subtitle1'>\n                                    {t('tweaks.about.description')}\n                                </Typography>\n                            </Box>\n                            <Box marginRight={-4}>\n                                <Terminal commands={SPELLBOOK_COMMANDS} />\n                            </Box>\n                        </Stack>\n                    </Container>\n                )}\n                <Container maxWidth='lg'>\n                    {!matchedTweaks && cachedTweaks && TWEAK_CATEGORIES.map(category => (\n                        <SectionedGridView\n                            sx={{\n                                paddingY : 4,\n                            }}\n                            key={category}\n                            paddingTop={4}\n                            color='secondary'\n                            title={category}>\n                            {cachedTweaks.filter(tweak => tweak.category === category).map(tweak => (\n                                <TweakView\n                                    key={tweak.id}\n                                    tweak={tweak} />\n                            ))}\n                        </SectionedGridView>\n                    ))}\n                    {matchedTweaks && (\n                        <GridView sx={{\n                            paddingTop : 4,\n                        }}>\n                            {(matchedTweaks ?? cachedTweaks ?? []).map(tweak => (\n                                <TweakView\n                                    key={tweak.id}\n                                    tweak={tweak} />\n                            ))}\n                        </GridView>\n                    )}\n                </Container>\n            </Stack>\n            <Loading show={!data || !!error}>\n                <Typography color={theme => theme.palette.getContrastText(theme.palette.text.primary)}>\n                    {t('tweaks.loading')}\n                </Typography>\n            </Loading>\n        </>\n    );\n};\n"],"names":["_interopRequireDefault","require$$0","Settings","default_1","_createSvgIcon","require$$1","_jsxRuntime","require$$2","Tweaks","query","setQuery","useState","matchedTweaks","setMatchedTweaks","cachedTweaks","setCachedTweaks","tweaks","useAppSelector","state","data","error","useTweaksQuery","TWEAKS_REFRESH_INTERVAL","searchEngine","useRef","MiniSearch","SEARCH_FUZZINESS","dispatch","useAppDispatch","app","useContext","FirebaseContext","isPending","startTransition","useTransition","t","useTranslation","search","useCallback","keyword","logSearch","result","handleSearch","TweakView","tweak","tweakRef","isSelected","selected","handleSelectionChange","logAddToCart","logRemoveFromCart","addTweak","removeTweak","handleValueChange","parameter","value","targetIndex","oldValue","index","handleSubmit","updatedTweak","newCachedTweaks","cachedTweak","newMatchedTweaks","matchedTweak","selectedTweak","updateTweak","useEffect","jsx","SelectableCardView","StyledButton","TweakDetailsView","MIN_SEARCH_LENGTH","handleError","logPageView","jsxs","Fragment","Stack","Box","Container","Typography","SearchInput","Terminal","SPELLBOOK_COMMANDS","TWEAK_CATEGORIES","category","SectionedGridView","GridView","Loading","theme"],"mappings":"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","x_google_ignoreList":[0]}